name: Publish

on:
  push:
    branches: main

jobs:
  build:

    runs-on: ${{ matrix.os }}

    strategy:
      matrix:
        os: [ubuntu-latest, macos-latest, windows-latest]
        package: [swig, swig-jse]

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Get Conan
        id : conan
        uses: turtlebrowser/get-conan@main

      - name: Conan version
        run: echo "${{ steps.conan.outputs.version }}"

      - name: Create default profile
        run: conan profile detect

      - name: Identify latest version
        run: |
          pip install pyyaml
          python get_version.py ${{ matrix.package }}/config.yml
          python get_version.py ${{ matrix.package }}/config.yml >> $GITHUB_ENV

      - name: Create package
        run: conan create ${{ matrix.package }}/all --version ${{ env.LATEST }}
